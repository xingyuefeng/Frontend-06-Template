<script>

  let object = {a: 1, b: 2}

  let callbacks = new Map()

  let usedReactivies = []

  let po = reactive(object)

  effect(() => console.log('effect--->', po.a))

  function effect(callback) {
    usedReactivies = []
    callback()
    
    // console.log('usedReactivies--->', usedReactivies)

    for (let reactivity of usedReactivies) {
      // 防重复添加
      if (!callbacks.has(reactivity[0])) {
        callbacks.set(reactivity[0], new Map())
      }
      if (!callbacks.get(reactivity[0]).has(reactivity[1])) {
        callbacks.get(reactivity[0]).set(reactivity[1], [])
      }

      callbacks.get(reactivity[0]).get(reactivity[1]).push(callback)
    }

  }

  function reactive(object) {
    return new Proxy(object, {
      set: (obj, prop, val) => {
        obj[prop] = val
        if (callbacks.get(obj)) {
          if (callbacks.get(obj).get(prop)) {
            callbacks.get(obj).get(prop).forEach(itm => itm())
          }
        }
        return obj[prop]
      },
      get: (obj, prop) => {
        usedReactivies.push([obj, prop])
        return obj[prop]
      }
    })
  }
</script>